import { Routes, Route } from "react-router-dom";
import React, { useEffect, useState } from "react";
import axios from "axios";
import { useDispatch, useSelector } from "react-redux";
import { Cookies } from "react-cookie";
import "./style/index.css";
import ScrollToTop from "./Component/ScrollToTop";
// Î©îÏù∏
import Index from "./Component/Index";
import Navbar from "./Component/Navbar/Navbar";
import Heading from "./Component/Heading/Heading";
import Footing from "./Component/Footing/Footing";
import MySlider from "./Component/MySlider/Slider";
import BestProduct from "./Component/product/BestProduct";
import NewProduct from "./Component/product/NewProduct";

// Î°úÍ∑∏Ïù∏
import Login from "./Component/Login";

// ÌöåÏõêÍ∞ÄÏûÖ
import MemberTerms from "./Component/Member/MemberTerms";
import MemberRegister from "./Component/Member/MemberRegister";

// ÎßàÏù¥ÌéòÏù¥ÏßÄ
import Sidebar from "./Component/MyPage/Sidebar";
import MyPage from "./Component/MyPage/MyPage";
import Points from "./Component/MyPage/PointList";
import WishlistPage from "./Component/MyPage/WishlistPage";
import OrderHistoryPage from "./Component/MyPage/OrderHistoryPage";
import MyReview from "./Component/MyPage/MyReview";
import MyReviewDetail from "./Component/MyPage/MyReviewDetail";
import ReviewPage from "./Component/MyPage/ReviewPage";
import EditProfile from "./Component/MyPage/EditProfile";
import RecentlyViewedPage from "./Component/MyPage/RecentlyViewedPage";
import QnaList from "./Component/Customer/QnaList";
import QnaView from "./Component/Customer/QnaView";
import WriteQna from "./Component/Customer/WriteQna";

// Ï†úÌíà
// import RingPage from "./Component/Category/RingPage";
// import EarRingPage from "./Component/Category/EarRingPage";
// import NecklacePage from "./Component/Category/NecklacePage";
// import BraceletPage from "./Component/Category/BraceletPage";
import DisplayPage from "./Component/Category/DisplayPage";
import SearchResults from "./Component/Search/SearchResults";
import GoldSilverPage from "./Component/Category/GoldSilverPage";

// Ï†úÌíà ÏÉÅÏÑ∏
import ProducDetail from "./Component/product/ProducDetail";
import ReviewDetail from "./Component/review/ReviewDetail";

// Ï£ºÎ¨∏ Í¥ÄÎ†®
import Cartlist from "./Component/Cart/Cartlist";
import OrderList from "./Component/Order/OrderList";
import OrderDetail from "./Component/Order/OrderDetail";
// Í≥†Í∞ù ÏÑºÌÑ∞
import CustomerServicePage from "./Component/Customer/CustomerServicePage";
import CustomerWriteQna from "./Component/Customer/CustomerWriteQna";
import CustomerQnaView from "./Component/Customer/CustomerQnaView";
// Î°úÍ∑∏Ïù∏ Ïö¥ÏòÅ
import { loginAction, logoutAction } from "./store/userSlice";
import jaxios from "./util/jwtUtil";
import MainSlider from "./Component/MySlider/Slider"; // ÎßûÏ∂§Ìòï Ï∂îÏ≤ú ÏÉÅÌíà Ïä¨ÎùºÏù¥Îçî

// Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ
import ADMIN_URL from "./config";

function App() {
  const dispatch = useDispatch();
  const loginUser = useSelector((state) => state.user);
  const [allProducts, setAllProducts] = useState([]);
  useEffect(() => {
    console.log("üü¢ [App.js] Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò Ïã§Ìñâ Ïãú Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥ ÌôïÏù∏");

    const storedUser = JSON.parse(localStorage.getItem("loginUser"));

    if (!storedUser) return; // ‚úÖ Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥ ÏóÜÏúºÎ©¥ API ÏöîÏ≤≠ Ïïà Ìï®

    axios
      .get("/api/member/userinfo", { withCredentials: true })
      .then((response) => {
        if (!response.data.memberId) {
          dispatch(logoutAction());
        } else {
          dispatch(loginAction(response.data));
        }
      })
      .catch((error) => {
        if (error.response?.status === 401) {
          dispatch(logoutAction());
        }
      });
  }, [dispatch]);

  return (
    <div className="App">
      {/* ÏÉàÎ°úÏö¥ ÌéòÏù¥ÏßÄ Ïó¥Î©¥ Ïä§ÌÅ¨Î°§ ÏÉÅÎã® Í≥†Ï†ï */}
      <ScrollToTop />
      <Routes>
        {/* Î©îÏù∏ */}
        <Route
          path="/"
          element={
            <>
              <Navbar />
              <Heading />
              {loginUser.memberId ? (
                <MainSlider memberId={loginUser.memberId} isLoggedIn={true} />
              ) : (
                <MainSlider />
              )}
              <Index />
              <Footing />
            </>
          }
        />

        <Route
          path="/bestProduct"
          element={
            <>
              <Navbar />
              <BestProduct />
              <Footing />
            </>
          }
        />
        <Route
          path="/newProduct"
          element={
            <>
              <Navbar />
              <NewProduct />
              <Footing />
            </>
          }
        />

        {/* Î°úÍ∑∏Ïù∏ Î∞è ÌöåÏõêÍ∞ÄÏûÖ */}
        <Route
          path="/login"
          element={
            <>
              <Navbar /> <Login />
              <Footing />
            </>
          }
        />
        <Route
          path="/memberTerms"
          element={
            <>
              <Navbar /> <MemberTerms />
              <Footing />
            </>
          }
        />
        <Route
          path="/memberRegister"
          element={
            <>
              <Navbar /> <MemberRegister />
              <Footing />
            </>
          }
        />

        {/* ÎßàÏù¥ÌéòÏù¥ÏßÄ */}
        <Route
          path="/myPage"
          element={
            <>
              <Navbar /> <MyPage />
              <Footing />
            </>
          }
        />
        <Route
          path="/mypage/points"
          element={
            <>
              <Navbar /> <Points />
              <Footing />
            </>
          }
        />
        <Route
          path="/mypage/wishlistPage"
          element={
            <>
              <Navbar /> <WishlistPage />
              <Footing />
            </>
          }
        />
        <Route
          path="/mypage/orders"
          element={
            <>
              <Navbar />
              <OrderHistoryPage />
              <Footing />
            </>
          }
        />
        <Route
          path="/mypage/reviews"
          element={
            <>
              <Navbar />
              <MyReview />
              <Footing />
            </>
          }
        />
        <Route
          path="/mypage/reviewDetail/:reviewSeq"
          element={
            <>
              <Navbar />
              <MyReviewDetail />
              <Footing />
            </>
          }
        />
        <Route
          path="/review/:orderSeq/:productSeq/:orderdetailSeq"
          element={
            <>
              <Navbar />
              <ReviewPage />
            </>
          }
        />
        <Route
          path="/mypage/edit-profile"
          element={
            <>
              <Navbar /> <EditProfile />
              <Footing />
            </>
          }
        />
        <Route
          path="/mypage/recentlyViewedPage"
          element={
            <>
              <Navbar />
              <RecentlyViewedPage />
              <Footing />
            </>
          }
        />

        {/* Ï†úÌíà Î∞è Ïπ¥ÌÖåÍ≥†Î¶¨ */}
        <Route
          path="/:category"
          element={
            <>
              <Navbar />
              <DisplayPage setFilteredItems={setAllProducts} />
              <Footing />
            </>
          }
        />
        <Route 
        path="/gold-silver" 
        element={
            <>
              <Navbar /><GoldSilverPage allProducts={allProducts} />
              <Footing />
            </>
          }
        />
        {/* Í≤ÄÏÉâ Í≤∞Í≥º ÌéòÏù¥ÏßÄ */}
        <Route
          path="/search"
          element={
            <>
              <Navbar />
              <SearchResults />
              <Footing />
            </>
          }
        />

        {/* Ï†úÌíà ÏÉÅÏÑ∏ */}
        <Route
          path="/producDetail/:productSeq"
          element={
            <>
              <Navbar />
              <ProducDetail />
            </>
          }
        />
        <Route
          path="/reviewDetail"
          element={
            <>
              <Navbar /> <ReviewDetail />
              <Footing />
            </>
          }
        />

        {/* Ï£ºÎ¨∏ */}
        <Route
          path="/cartlist"
          element={
            <>
              <Navbar />
              <Cartlist />
              <Footing />
            </>
          }
        />
        <Route
          path="/orderList"
          element={
            <>
              <Navbar />
              <OrderList />
              <Footing />
            </>
          }
        />
        <Route
          path="/orderDetail"
          element={
            <>
              <Navbar />
              <OrderDetail />
              <Footing />
            </>
          }
        />

        {/* Í≥†Í∞ùÏÑºÌÑ∞ */}

        <Route
          path="/Customer/*"
          element={
            <>
              <Navbar />
              <CustomerServicePage />
              <Footing />
            </>
          }
        />
        {/*Í≥†Í∞ùÏÑºÌÑ∞ qnaÏûëÏÑ± */}
        <Route
          path="/customerWriteQna/*"
          element={
            <>
              <Navbar />
              <CustomerWriteQna />
              <Footing />
            </>
          }
        />
        {/* Í≥†Í∞ùÏÑºÌÑ∞ qnaÏ°∞Ìöå */}
        <Route
          path="/customerQnaView/:qnaSeq"
          element={
            <>
              <Navbar />
              <CustomerQnaView />
              <Footing />
            </>
          }
        />
        {/* ÏûêÏ£º Î¨ªÎäî ÏßàÎ¨∏ ÌéòÏù¥ÏßÄ*/}
        <Route
          path="/qnaList"
          element={
            <>
              <Navbar />
              <QnaList />
              <Footing />
            </>
          }
        />
        {/* Qna ÏÉÅÏÑ∏Î≥¥Í∏∞ ÌéòÏù¥ÏßÄ*/}
        <Route
          path="/qnaView/:qnaSeq"
          element={
            <>
              <Navbar /> <QnaView /> <Footing />
            </>
          }
        />
        {/* Qna ÏûëÏÑ± ÌéòÏù¥ÏßÄ*/}
        <Route
          path="/writeQna"
          element={
            <>
              <Navbar />
              <WriteQna />
              <Footing />
            </>
          }
        />
        {/* ‚úÖ Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ Ï∂îÍ∞Ä */}
        

        {/* ‚úÖ ÌôòÍ≤ΩÏóê Îî∞Îùº ÏûêÎèôÏúºÎ°ú Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô */}
        <Route
          path="/go-admin"
          element={
            <a href={ADMIN_URL}>Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô</a>
          }
        />

      </Routes>
    </div>
  );
}

export default App;
